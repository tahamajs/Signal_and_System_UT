% کد MATLAB برای تحلیل سیستم تعلیق اتومبیل با مقادیر مختلف ضریب میرایی B
% فرضیات: M = 1 kg، K = 1 N/m

% پاکسازی محیط کاری
clear; clc; close all;

% تعریف پارامترها
M = 1;      % جرم اتومبیل (kg)
K = 1;      % سختی فنر (N/m)
B_values = [0, 0.1, 10, 100];  % مقادیر مختلف ضریب میرایی (Ns/m)

% تعریف بازه زمانی شبیه‌سازی
t = 0:0.001:10;  % از 0 تا 10 ثانیه با گام زمانی 0.001 ثانیه

% تعریف رنگ‌ها برای ترسیم نمودارها
colors = ['b', 'g', 'r', 'm'];  % رنگ‌های مختلف برای ترسیم
legend_entries = cell(length(B_values),1);  % ایجاد لیست عناوین برای افسانه نمودار

%% بخش 1: شبیه‌سازی و رسم پاسخ ضربه برای مقادیر مختلف B
figure;
hold on;
for i = 1:length(B_values)
    B = B_values(i);
    
    % تعریف تابع تبدیل H(s) = (1 + B*s) / (s^2 + B*s + 1)
    numerator = [B 1];
    denominator = [1 B 1];
    H = tf(numerator, denominator);
    
    % محاسبه پاسخ ضربه سیستم با استفاده از تابع impulse
    [y_imp, t_imp] = impulse(H, t);
    
    % ترسیم پاسخ ضربه
    plot(t_imp, y_imp, colors(i), 'LineWidth', 2);
    legend_entries{i} = ['B = ' num2str(B) ' Ns/m'];
end

% تنظیمات نمودار پاسخ ضربه
title('پاسخ ضربه سیستم تعلیق اتومبیل برای مقادیر مختلف B');
xlabel('زمان (ثانیه)');
ylabel('جابجایی کابین y(t) (m)');
legend(legend_entries, 'Location', 'best');
grid on;
hold off;

%% بخش 2: مقایسه پاسخ شبیه‌سازی شده و نظری برای B = 0
% در این قسمت، وضعیت بدون تعدیل‌کننده (B = 0) شبیه‌سازی شده و پاسخ نظری آن محاسبه می‌شود
B = 0;
numerator = [B 1];
denominator = [1 B 1];
H = tf(numerator, denominator);
[y_imp, t_imp] = impulse(H, t);

% محاسبه پاسخ نظری
s_roots = roots(denominator);
s1 = s_roots(1);
s2 = s_roots(2);

% محاسبه ثابت‌های تجزیه کسر جزئی
A = (1 + B*s1) / (s1 - s2);
C1 = A;
C2 = 1 - A;

% محاسبه پاسخ نظری
y_theoretical = C1 * exp(s1 * t) + C2 * exp(s2 * t);

% ترسیم مقایسه پاسخ شبیه‌سازی شده و پاسخ نظری برای B = 0
figure;
plot(t_imp, y_imp, 'b', 'LineWidth', 2); hold on;
plot(t, y_theoretical, 'r--', 'LineWidth', 2);
title(['مقایسه پاسخ ضربه سیستم تعلیق اتومبیل برای B = ' num2str(B) ' Ns/m']);
xlabel('زمان (ثانیه)');
ylabel('جابجایی کابین y(t) (m)');
legend('پاسخ شبیه‌سازی شده', 'پاسخ نظری', 'Location', 'best');
grid on;
hold off;

%% بخش 3: شبیه‌سازی و مقایسه برای B = 100
% در این قسمت، سیستم با ضریب میرایی بسیار قوی (B = 100) شبیه‌سازی شده و پاسخ نظری آن محاسبه می‌شود
B = 100;
numerator = [B 1];
denominator = [1 B 1];
H = tf(numerator, denominator);
[y_imp, t_imp] = impulse(H, t);

% محاسبه پاسخ نظری
s_roots = roots(denominator);
s1 = s_roots(1);
s2 = s_roots(2);

% محاسبه ثابت‌های تجزیه کسر جزئی
A = (1 + B*s1) / (s1 - s2);
C1 = A;
C2 = 1 - A;

% محاسبه پاسخ نظری
y_theoretical = C1 * exp(s1 * t) + C2 * exp(s2 * t);

% ترسیم مقایسه پاسخ شبیه‌سازی شده و پاسخ نظری برای B = 100
figure;
plot(t_imp, y_imp, 'b', 'LineWidth', 2); hold on;
plot(t, y_theoretical, 'r--', 'LineWidth', 2);
title(['مقایسه پاسخ ضربه سیستم تعلیق اتومبیل برای B = ' num2str(B) ' Ns/m']);
xlabel('زمان (ثانیه)');
ylabel('جابجایی کابین y(t) (m)');
legend('پاسخ شبیه‌سازی شده', 'پاسخ نظری', 'Location', 'best');
grid on;
hold off;

%% بخش 4: مقایسه تمامی پاسخ‌ها در یک نمودار
figure;
hold on;
for i = 1:length(B_values)
    B = B_values(i);
    numerator = [B 1];
    denominator = [1 B 1];
    H = tf(numerator, denominator);
    [y_imp, t_imp] = impulse(H, t);
    plot(t_imp, y_imp, colors(i), 'LineWidth', 2);
end
title('مقایسه پاسخ ضربه سیستم تعلیق اتومبیل برای مقادیر مختلف B');
xlabel('زمان (ثانیه)');
ylabel('جابجایی کابین y(t) (m)');
legend(legend_entries, 'Location', 'best');
grid on;
hold off;

%% بخش 5: شبیه‌سازی پاسخ سیستم با ورودی پله‌ای نزدیک به صفر
% در این قسمت، ورودی پله‌ای با زمان شروع نزدیک به صفر شبیه‌سازی شده و پاسخ سیستم برای مقادیر مختلف B ترسیم می‌شود
figure;
hold on;
for i = 1:length(B_values)
    B = B_values(i);
    numerator = [B 1];
    denominator = [1 B 1];
    H = tf(numerator, denominator);
    
    % تعریف ورودی پله‌ای نزدیک به صفر
    step_time = 0.001;  % زمان شروع پله
    step_initial = 0;    % مقدار اولیه پله
    step_final = 1;      % مقدار نهایی پله
    
    % تعریف ورودی پله‌ای
    u = [step_initial, step_final];
    t_step_vec = [step_time, step_time];
    
    % محاسبه پاسخ سیستم به ورودی پله‌ای
    [y_step, t_step] = step(H, t);
    
    % ترسیم پاسخ پله‌ای
    plot(t_step, y_step, colors(i), 'LineWidth', 2);
end
title('پاسخ پله سیستم تعلیق اتومبیل برای مقادیر مختلف B');
xlabel('زمان (ثانیه)');
ylabel('جابجایی کابین y(t) (m)');
legend(legend_entries, 'Location', 'best');
grid on;
hold off;

%% بخش 6: جمع‌بندی و تحلیل نتایج

% این بخش به صورت متنی ارائه می‌شود و در کد قابل اجرا نیست.
% با اجرای کد فوق، شما می‌توانید پاسخ‌های سیستم تعلیق اتومبیل را برای مقادیر مختلف B مشاهده کنید.
% همچنین، مقایسه پاسخ‌های شبیه‌سازی شده با پاسخ‌های نظری نشان‌دهنده صحت مدل‌سازی است.

% نتیجه‌گیری:
% - برای B = 0: سیستم بدون تعدیل‌کننده است و دارای نوسانات بی‌پایان و شدید است. این وضعیت منجر به لرزش‌های شدید کابین می‌شود و سیستم ناپایدار است.
% - برای B = 0.1: سیستم دارای میرایی ضعیف است و نوسانات پاسخ کاهش یافته ولی هنوز قابل توجه هستند.
% - برای B = 10: سیستم دارای میرایی متوسط است و پاسخ سریع‌تر به حالت پایداری می‌رسد و نوسانات به طور قابل توجهی کاهش یافته‌اند.
% - برای B = 100: سیستم دارای میرایی بسیار قوی است و پاسخ سیستم به سرعت به حالت پایداری می‌رسد بدون نوسانات اضافی. این وضعیت سیستم را کاملاً پایدار می‌کند، اما ممکن است پاسخ بسیار آرام باشد.

% انتخاب بهترین حالت برای سیستم تعلیق اتومبیل معمولاً بین B = 10 و B = 100 متغیر است. مقدار B = 10 تعادل مناسبی بین کاهش نوسانات و پاسخ سریع سیستم فراهم می‌کند، در حالی که B = 100 باعث پایداری بسیار بالا اما ممکن است پاسخ بسیار آرام باشد.

% پایان کد
